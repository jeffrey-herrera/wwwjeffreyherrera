---
import Layout from '../layouts/Layout.astro';
import PlaylistCard from '../components/PlaylistCard.astro';
import { getAllPlaylists } from '../sanity/queries';

const playlists = await getAllPlaylists();

// Group playlists by year
const playlistsByYear = playlists.reduce((acc, playlist) => {
  const year = playlist.year;
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(playlist);
  return acc;
}, {} as Record<number, typeof playlists>);

// Sort years in descending order
const sortedYears = Object.keys(playlistsByYear)
  .map(year => parseInt(year))
  .sort((a, b) => b - a);
---

<Layout>
  <div class="py-16">
    <header class="mb-12">
      <h1 class="text-4xl font-serif mb-4">Playlists</h1>
      <p class="text-xl text-stone-500">Monthly music curation spanning different moods and moments</p>
    </header>

    <main class="space-y-16">
      {sortedYears.map(year => (
        <section>
          <h2 class="text-2xl font-serif mb-8 text-stone-800">{year}</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
            {playlistsByYear[year].map(playlist => (
              <PlaylistCard playlist={playlist} />
            ))}
          </div>
        </section>
      ))}
    </main>
  </div>
</Layout>


