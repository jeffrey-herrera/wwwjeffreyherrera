---
import Layout from '../layouts/Layout.astro';
import { getAllPlaylists } from '../sanity/queries';
import type { Playlist } from '../sanity/types';
import PlaylistCard from '../components/PlaylistCard.astro';

const playlists = await getAllPlaylists();

const playlistsByYear = playlists.reduce((acc, playlist) => {
  const year = playlist.year;
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(playlist);
  return acc;
}, {} as Record<number, Playlist[]>);

const sortedYears = Object.keys(playlistsByYear).map(Number).sort((a, b) => b - a);
---

<Layout>
  <div class="py-16">
    <header class="mb-12">
      <h1 class="text-4xl font-serif mb-4">Playlists</h1>
      <p class="text-xl text-stone-500">Monthly music curation spanning different moods and moments</p>
    </header>

    <div class="space-y-16">
      {sortedYears.map(year => (
        <section>
          <h2 class="text-2xl font-bold mb-8">{year}</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
            {playlistsByYear[year].map(playlist => (
              <PlaylistCard playlist={playlist} />
            ))}
          </div>
        </section>
      ))}
    </div>
  </div>
</Layout>


